{% extends "base.html" %}
{% block title %}Financeiro – CRM Advocacia{% endblock %}
{% block page_title %}Financeiro – Lançamentos{% endblock %}
{% block content %}

<!-- Totalizadores -->
<div class="row g-3 mb-3">
  <div class="col-sm-4">
    <div class="card border-0 bg-warning bg-opacity-10">
      <div class="card-body py-3">
        <div class="text-muted small">Pendente</div>
        <div class="fs-5 fw-bold text-warning">R$ {{ totais.total_pendente|default:"0.00" }}</div>
      </div>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="card border-0 bg-danger bg-opacity-10">
      <div class="card-body py-3">
        <div class="text-muted small">Atrasado</div>
        <div class="fs-5 fw-bold text-danger">R$ {{ totais.total_atrasado|default:"0.00" }}</div>
      </div>
    </div>
  </div>
  <div class="col-sm-4">
    <div class="card border-0 bg-success bg-opacity-10">
      <div class="card-body py-3">
        <div class="text-muted small">Pago</div>
        <div class="fs-5 fw-bold text-success">R$ {{ totais.total_pago|default:"0.00" }}</div>
      </div>
    </div>
  </div>
</div>

<!-- Filtros e ação -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <form class="d-flex gap-2 flex-wrap" method="get">
    <input type="text" name="q" value="{{ q }}" class="form-control form-control-sm" placeholder="Cliente ou descrição…" style="width:200px">
    <select name="status" class="form-select form-select-sm" style="width:150px">
      <option value="">Todos os status</option>
      {% for val, label in status_choices %}
      <option value="{{ val }}" {% if status_filtro == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <select name="tipo" class="form-select form-select-sm" style="width:160px">
      <option value="">Todos os tipos</option>
      {% for val, label in tipo_choices %}
      <option value="{{ val }}" {% if tipo_filtro == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-sm btn-outline-secondary"><i class="bi bi-search"></i></button>
  </form>
  <a href="{% url 'novo_lancamento' %}" class="btn btn-primary btn-sm"><i class="bi bi-plus me-1"></i> Novo Lançamento</a>
</div>

<div class="card">
  <div class="card-body p-0">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Descrição</th>
          <th>Tipo</th>
          <th>Cliente</th>
          <th>Processo</th>
          <th>Valor</th>
          <th>Vencimento</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for l in lancamentos %}
        <tr>
          <td><a href="{% url 'detalhe_lancamento' l.pk %}" class="fw-semibold">{{ l.descricao }}</a></td>
          <td><span class="badge bg-secondary">{{ l.get_tipo_display }}</span></td>
          <td>{{ l.cliente.nome }}</td>
          <td>{% if l.processo %}<a href="{% url 'detalhe_processo' l.processo.pk %}">{{ l.processo.numero }}</a>{% else %}<span class="text-muted">–</span>{% endif %}</td>
          <td class="fw-semibold">R$ {{ l.valor }}</td>
          <td>{{ l.data_vencimento|date:"d/m/Y" }}</td>
          <td>
            <span class="badge
              {% if l.status == 'pago' %}bg-success
              {% elif l.status == 'atrasado' %}bg-danger
              {% elif l.status == 'pendente' %}bg-warning text-dark
              {% else %}bg-secondary{% endif %}">
              {{ l.get_status_display }}
            </span>
          </td>
          <td>
            <a href="{% url 'editar_lancamento' l.pk %}" class="btn btn-sm btn-outline-secondary" title="Editar"><i class="bi bi-pencil"></i></a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="8" class="text-center text-muted py-3">Nenhum lançamento encontrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
