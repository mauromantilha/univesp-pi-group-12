{% extends "base.html" %}
{% block title %}Processos – CRM Advocacia{% endblock %}
{% block page_title %}Processos{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <form class="d-flex gap-2" method="get">
    <input type="text" name="q" value="{{ q }}" class="form-control form-control-sm" placeholder="Buscar número ou cliente…">
    <select name="status" class="form-select form-select-sm" style="width:180px">
      <option value="">Todos os status</option>
      {% for val, label in status_choices %}
      <option value="{{ val }}" {% if status_filtro == val %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
    <button type="submit" class="btn btn-sm btn-outline-secondary"><i class="bi bi-search"></i></button>
  </form>
  <a href="{% url 'novo_processo' %}" class="btn btn-primary btn-sm"><i class="bi bi-plus me-1"></i> Novo Processo</a>
</div>
<div class="card">
  <div class="card-body p-0">
    <table class="table table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>Número</th>
          <th>Cliente</th>
          <th>Advogado</th>
          <th>Tipo</th>
          <th>Vara</th>
          <th>Status</th>
          <th>Cadastrado</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for p in processos %}
        <tr>
          <td><a href="{% url 'detalhe_processo' p.pk %}" class="fw-semibold">{{ p.numero }}</a></td>
          <td>{{ p.cliente }}</td>
          <td>{{ p.advogado.get_full_name|default:p.advogado.username|default:"–" }}</td>
          <td>{{ p.tipo|default:"–" }}</td>
          <td>{{ p.vara|default:"–" }}</td>
          <td>
            <span class="badge {% if p.status == 'em_andamento' %}bg-primary{% elif p.status == 'suspenso' %}bg-warning text-dark{% elif p.status == 'finalizado' %}bg-success{% else %}bg-secondary{% endif %}">
              {{ p.get_status_display }}
            </span>
          </td>
          <td><small>{{ p.criado_em|date:"d/m/Y" }}</small></td>
          <td>
            <a href="{% url 'detalhe_processo' p.pk %}" class="btn btn-sm btn-outline-primary" title="Ver"><i class="bi bi-eye"></i></a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="8" class="text-center text-muted py-3">Nenhum processo encontrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
